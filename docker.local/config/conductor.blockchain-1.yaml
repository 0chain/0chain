###
### Blockchain miners Byzantine tests
###

---

# enabled test cases sets
enable:
  # comment out a line to disable
- "VRF"
# - "Round timeout"
# - "Bad block"
# - "Verification tickets"
# - "Notarized block"

# sets of test cases
sets:
  - name: "VRF"
    tests:
      - "Send VRFS only to group"
      - "Send only the group the correct VRFS (bad VRFS for everyone else)"
      - "Send no VRFS"
  - name: "Round timeout"
    tests:
      - "Don't send a round timeout"
      - "Send timeouts only to group"
      - "Send wrong timeout to everyone"
      - "Send correct timeout only to group"
  - name: "Bad block"
    tests:
      - "(Create competing block) Individual or group create competing block when not a generator"
      - "(Create competing block) Group only signs the competing blocks"
      - "Send a transaction from an earlier block to create a double spend"
      - "(Incorrectly sign the block) Sign the a different hash than the block hash"
      - "(Incorrectly sign the block) Use a different private key to sign the block"
      - "Hash the block incorrectly"
  - name: "Verification tickets"
    tests:
      - "Only verify a block from the group"
      - "Individuals or group can send no tickets to slow down or stall the chain"
      - "(Send bad verification ticket) The signed with wrong key"
      - "(Send bad verification ticket) Signed wrong hash"
  - name: "Notarized block"
    tests:
      - "(Sign the block incorrectly) Use the wrong hash"
      - "(Sign the block incorrectly) Use the wrong private key"
      - "Don't send the notarized block (don't send verification ticket as well)"
      - "Only notarize/send competing block from C.1.b. (Group only signs the competing blocks)"


#
# test cases
#
tests:
  # VRFS
  - name: "Send VRFS only to group"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3", "miner 4", "miner 5"]
      - wait_view_change:
          expected_magic_block:
            round: 251
            miners: ["miner 1", "miner 2", "miner 3", "miner 4", "miner 5"]
            sharders: ["sharder 1"]
      - wait_round:
          round: 261 # wait a round after the VC
      - vrfs:
          by: ["miner 5"]
          good: ["miner 1", "miner 2", "miner 3", "miner 4"]
      - wait_round:
          round: 280
      - vrfs:
          by: ["miner 5"]
          good: ["miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 290
      - vrfs:
          by: ["miner 5"]
          good: ["miner 1", "miner 2"]
  - name: "Send only the group the correct VRFS (bad VRFS for everyone else)"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Send no VRFS"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  # Round timeout
  - name: "Don't send a round timeout"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Send timeouts only to group"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Send wrong timeout to everyone"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Send correct timeout only to group"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  # Bad block
  - name: "(Create competing block) Individual or group create competing block when not a generator"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Create competing block) Group only signs the competing blocks"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Send a transaction from an earlier block to create a double spend"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Incorrectly sign the block) Sign the a different hash than the block hash"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Incorrectly sign the block) Use a different private key to sign the block"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Hash the block incorrectly"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  # Verification tickets
  - name: "Only verify a block from the group"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Individuals or group can send no tickets to slow down or stall the chain"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Send bad verification ticket) The signed with wrong key"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Send bad verification ticket) Signed wrong hash"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  # Notarized block
  - name: "(Sign the block incorrectly) Use the wrong hash"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "(Sign the block incorrectly) Use the wrong private key"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Don't send the notarized block (don't send verification ticket as well)"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
  - name: "Only notarize/send competing block from C.1.b. (Group only signs the competing blocks)"
    flow:
      - set_monitor: "sharder 1"
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round: 20
...
