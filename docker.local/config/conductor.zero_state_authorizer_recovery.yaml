enable:
  - "Authorizer Recovery"

# sets of test cases
sets:
  - name: "Authorizer Recovery"
    tests:
      - "Authorizer Recovery - Authorizer should recover from zero state and continue to function"

tests:
  - name: "Authorizer Recovery - Authorizer should recover from zero state and continue to function"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: {}
      - command:
          name: "cleanup_0dns"
      - start: ['sharder-1', 'sharder-2', 'miner-1', 'miner-2', 'miner-3', 'miner-4']
      - wait_round:
          round: 15 # just wait the BC starts
      - start: ['0dns']
      - sleep: "20s"
      - start: ['0box']
      - sleep: "20s"
      - wait_round:
          shift: 50
      - command:
          name: "register_authorizer"          
      - wait_add:
          authorizers: ['authorizer-1','authorizer-2','authorizer-3','authorizer-4']
          start: true
      - wait_round:
          shift: 200
      - sync_latest_aggregates:
          authorizers:
            - "1746b06bb09f55ee01b33b5e2e055d6cc7a900cb57c0a3a5eaabb8a0e7745802"
          required: true
      - round_random_seed:
          random_seed: 54
      - command:
          name: "mint_zcn"
      - wait_round:
          shift: 100            
      - check_aggregate_value_change:
          provider_type: authorizer
          provider_id: "1746b06bb09f55ee01b33b5e2e055d6cc7a900cb57c0a3a5eaabb8a0e7745802"
          key: total_rewards
          monotonicity: increase
          timeout: "25m"          
      - stop: ['authorizer-1']
      - wait_round:
          shift: 100      
     - command:
            name: "cleanup_provider"
            params:
              path: "./token_bridge_authserver/docker.local/auth1"
              recreate_script: docker.local/bin/authorizer.init.setup.sh
              recreate_script_workdir: ./token_bridge_authserver

      - wait_round:
          shift: 100
      - start: ['authorizer-1']
      - wait_round:
          shift: 100
      - wait_add:
          authorizers: [ 'authorizer-1' ]
          start: true          
      - round_random_seed:
          random_seed: 54
      - command:
          name: "mint_zcn"
      - wait_round:
          shift: 100            
      - check_aggregate_value_change:
          provider_type: authorizer
          provider_id: "1746b06bb09f55ee01b33b5e2e055d6cc7a900cb57c0a3a5eaabb8a0e7745802"
          key: total_rewards
          monotonicity: increase
          timeout: "25m"
