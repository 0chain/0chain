###
### Byzantine view change tests
###

---

# enabled test cases sets
enable:
  # comment out to disable
  - "MPK"
  # - "Shares"
  # - "Signatures"
  # - "Publish"

# sets of test cases
sets:
  - name: "MPK"
    tests:
      - "Send wrong MPK to blockchain"
      - "Send no MPK to blockchain"
      - "Group send no MPK to blockchain"
  - name: "Shares"
    tests:
      - "Send wrong share"
      - "Only send correct share to the group"
      - "Send no shares"
  - name: "Signatures"
    tests:
      - "Don't send a signature"
      - "Only send correct signature to the group"
      - "Send no signatures"
  - name: "Publish"
    tests:
      - "Only include groups signatures"
      - "Send no signatures"
      - "Send wrong signatures"
      - "Send correct signatures only for the group"

# test cases
tests:

  # MPK
  - name: "Send wrong MPK to blockchain"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - mpk:
          by: ["miner 3"]
          good: []
          bad: ["miner 1", "miner 2"]
      - wait_round:
          round: 100
      - wait_no_view_chainge:
          round: 251
  - name: "Send no MPK to blockchain"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - mpk:
          by: ["miner 3"]
          good: []
          bad: []
        - wait_no_progress:
            timeout: "2m"
  - name: "Group send no MPK to blockchain"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - mpk:
          by: ["miner 1", "miner 2"]
          good: []
          bad: []
        - wait_no_progress:
            timeout: "2m"

  # Shares
  - name: "Send wrong share"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - share:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Only send correct share to the group"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - share:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Send no shares"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - share:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"

  # Signatures
  - name: "Don't send a signature"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - signature:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Only send correct signature to the group"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - signature:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Send no signatures"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - signature:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"

  # Publish
  - name: "Only include groups signatures"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - publish:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Send no signatures"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - publish:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Send wrong signatures"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - publish:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"
  - name: "Send correct signatures only for the group"
    flow:
      - set_monitor: {}
      - cleanup_bc: {}
      - start: ["sharder 1", "miner 1", "miner 2", "miner 3"]
      - wait_round:
          round: 10 # wait a round to be sure it starts
      - publish:
          by: ["miner 3"]
          good: ["miner 1", "miner 2"]
          bad: ["miner 1", "miner 2"]
        - wait_no_progress:
            timeout: "2m"

...
