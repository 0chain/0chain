enable:
  - "attack round transfer"
#  - "resend past messages"
#  - "restart"
#  - "attack fetching"
sets:
  - name: "attack round transfer"
    tests:
#      - "not notarised block extension"
      - "send different blocks from first generator"
#      - "send different blocks from all generators"
#      - "breaking single block"
#      - "send insufficient proposals"
#      - "verifying non existent block"
#      - "notarising non existent block"
  - name: "resend past messages"
    tests:
      - "resend proposed block"
      - "resend notarisation"
  - name: "restart"
    tests:
      - "bad timeout VRF share"
      - "half nodes down"
  - name: "attack fetching"
    tests:
      - "attack BlockStateChangeRequestor: neither node reply"
      - "attack BlockStateChangeRequestor: only one node replies"

tests:
  - name: "not notarised block extension"
    flow:
      - set_monitor: "miner-1"
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_not_notarised_block_extension_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0
      - make_test_case_check:
          wait_time: 5m
      - save_logs: {}

  - name: "send different blocks from first generator"
    flow:
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_send_different_blocks_from_first_generator_test_case:
          test_report:
            round: 30
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "send different blocks from all generators"
    flow:
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_send_different_blocks_from_all_generators_test_case:
          test_report:
            round: 30
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "breaking single block"
    flow:
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_breaking_single_block:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "send insufficient proposals"
    flow:
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_send_insufficient_proposals_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "verifying non existent block"
    flow:
      - set_monitor: "miner-1"
      - cleanup_bc: {}
      - start_lock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - configure_verifying_non_existent_block_test_case:
          test_report:
            round: 30
          hash: "d0cab02dd0f094eaa2d136fa335d4fbb7858832caebc416982187b2c9b58cecc"
      - unlock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - wait_round:
          round: 50
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "notarising non existent block"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: { }
      - start_lock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_notarising_non_existent_block_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 1
          hash: "d0cab02dd0f094eaa2d136fa335d4fbb7858832caebc416982187b2c9b58cecc"
      - unlock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - wait_round:
          round: 50
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "resend proposed block"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_resend_proposed_block_test_case:
          test_report:
            round: 30
            by_generator: true
            by_node_with_type_rank: 1
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "resend notarisation"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_resend_notarisation_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "bad timeout VRF share"
    flow:
      - set_monitor: "miner-1"
      - cleanup_bc: { }
      - start_lock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_bad_timeout_vrfs_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0
      - unlock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - wait_round:
          round: 50
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "half nodes down"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: { }
      - start: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2" ]
      - configure_half_nodes_down_test_case:
          test_report:
            round: 30
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "attack BlockStateChangeRequestor: neither node reply"
    flow:
      - set_monitor: "miner-1"
      - cleanup_bc: {}
      - start_lock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - configure_block_state_change_requestor_test_case:
          test_report:
            round: 30
            by_generator: true
            by_node_with_type_rank: 0

          ignoring_requests_by:
            miners:
              # Generator0
              - generator: true
                type_rank: 0

              # Generator1
              - generator: true
                type_rank: 1

              # Replica1
              - generator: false
                type_rank: 1

            sharders:
              - "sharder-1"
              - "sharder-2"

      - unlock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - wait_round:
          round: 50
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }

  - name: "attack BlockStateChangeRequestor: only one node replies"
    flow:
      - set_monitor: "miner-1"
      - cleanup_bc: {}
      - start_lock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - configure_block_state_change_requestor_test_case:
          test_report:
            round: 30
            by_generator: false
            by_node_with_type_rank: 0

          ignoring_requests_by:
            miners:
              # Generator1
              - generator: true
                type_rank: 1

              # Replica0
              - generator: false
                type_rank: 1

            sharders:
              - "sharder-1"
              - "sharder-2"

          correct_response_by:
            miners:
              # Generator0
              - generator: true
                type_rank: 0

      - unlock: [ "miner-1", "miner-2", "miner-3", "miner-4", "sharder-1", "sharder-2"]
      - wait_round:
          round: 50
      - make_test_case_check:
          wait_time: 5m
      - save_logs: { }