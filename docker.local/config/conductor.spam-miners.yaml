###
### Blockchain miners Byzantine tests
###

---
# enabled test cases sets
enable:
  - "VRF"

# sets of test cases
sets:
  - name: "VRF"
    tests:
      - "Spam VRFS to everyone"

#
# test cases
#	Flow of this test case:
#   There is a miner that that sends a VRF before the previous round has been notarized. This test checks whether this attack blocks the rest of network from working (creating new rounds and blocks).
#   1. All miners communicate honestly until 10th round
#   2. Lock notarization messages (Put messages on hold before processing on unlock step)
#   3. Replica_0 (Adv): send VRF_Share0_10
#   4. Replica_0 (Adv): wait for RRS 10 to generate VRF_Share0_11 for round 11 and send VRF_Share0_11
#   5. Unlock notarization messages
#   6. Wait for round 10 to be finalized and check RRS is the same of step 4
#   7. Check if round 11, round 12, etc (2 or 3 are enough) are finalized
tests:
  # VRF
  - name: "Spam VRFS to everyone"
    flow:
      - set_monitor: "sharder-1"
      - cleanup_bc: {}
      - start: ["sharder-1"]
      - start: ["miner-1", "miner-2", "miner-3", "miner-4"]
      - round_has_finalized:
          spammers:
            - node_type: 1 # replica node type
              type_rank: 0
          spamming_receiver:
            node_type: 0
            type_rank: 0
          round: 10
      - wait_round:
          shift: 10
          allow_beyond: true
      - make_test_case_check:
          wait_time: 10s
