- name: allocate a new elastic IP without associating it to anything
  ec2_eip:
    region: "{{ item }}"
    state: present
  register: eip
  with_items: "{{ regions }}"
  tags: eip-create

- name: output the IP
  debug:
    msg: "Allocated IP is {{ item.eip.public_ip }}"
  with_items: "{{eip.results}}"
  tags: eip-create


# List all EIP addresses in the current region.
- name: List all the EIP address in all the regions...
  ec2_eip_facts:
    region: "{{ item }}"
  register: regional_eip
  with_items: "{{ regions }}"
  tags: eip-list-all

- debug:
    msg: "{{ item |json_query(public_ip)}} {{item |json_query(region)}}"
  vars:
    public_ip: "addresses[*].public_ip"
    region: "invocation.module_args.region"
  with_items: "{{regional_eip.results}}"
  tags: eip-list-all
