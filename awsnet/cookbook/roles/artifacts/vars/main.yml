---
#The common script depends upon the following variables which are set in the Makefile
# credential - The location of the AWS keys
# network - The network to launch. Check receipes for the name of the network
# repodest - The destination directory to copy out the 0chain repository.

#AWS Key Setup
aws_credentials: "{{credential}}/aws/credentials"
aws_key_pair: "{{blueprint.aws_key_pair}}"
aws_key_dir: "{{credential}}/{{aws_key_pair}}"

aws_key_pair_file: "{{aws_key_dir}}/{{aws_key_pair}}.pem"
aws_public_key_file: "{{aws_key_dir }}/{{aws_key_pair}}.pub"

#Git Key Setup
git_key_dir: "{{credential}}/git"
git_key_pair: "github"
git_key_pair_file: "{{git_key_dir}}/{{git_key_pair}}.pem"
git_public_key_file: "{{git_key_dir }}/{{git_key_pair}}.pub"

#Regions that are supported
regions:
  'virginia': "us-east-1"
  'ohio': "us-east-2"
  'california': "us-west-1"
  'oregon': "us-west-2"
  'canada': "ca-central-1"
  'frankfurt': "eu-central-1"

region_tags: "{{regions.keys()}}"

primary: 'virginia'

primary_region: "{{regions[primary]}}"

miners:
  'm00': rank="00"
  'm01': rank="01"
  'm02': rank="02"
  'm03': rank="03"
  'm04': rank="04"
  'm05': rank="05"
  'm06': rank="06"
  'm07': rank="07"
  'm08': rank="08"
  'm09': rank="09"
  'm10': rank="10"
  'm11': rank="11"
  'm12': rank="12"
  'm13': rank="13"
  'm14': rank="14"
  'm15': rank="15"
  'm16': rank="16"
  'm17': rank="17"
  'm18': rank="18"
  'm19': rank="19"

sharders:
  's00': rank="00"
  's01': rank="01"
  's02': rank="02"
  's03': rank="03"
  's04': rank="04"
  's05': rank="05"
  's06': rank="06"
  's07': rank="07"
  's08': rank="08"
  's09': rank="09"
  's10': rank="10"
  's11': rank="11"
  's12': rank="12"
  's13': rank="13"
  's14': rank="14"
  's15': rank="15"
  's16': rank="16"
  's17': rank="17"
  's18': rank="18"
  's19': rank="19"


git:
  repo: "ssh://git@0chain.github.com/0chain/0chain.git"
  version: "{{blueprint.git_version}}"
  staging: "{{zchain_artifact}}/0chain"
  zip: "{{zchain_artifact}}/0chain.zip"

zchain_volumes:
  root: "/0chain_root"
  ebs: "/0chain"
  efs: "/0chain_efs"


artifact:
  local:
    base: "{{zchain_artifact}}"
    dirs:
      - 0chain
      - miner
      - sharder


  zchain:
    base: "{{zchain_volumes.ebs}}"
    code: "{{zchain_volumes.ebs}}/0chain"
    config: "{{zchain_volumes.ebs}}/config"

    dirs:
      'miner':
        - { canonical: "/0chain/0chain" }
        - { canonical: "/0chain/config" }
        - { canonical: "/0chain/nodes" }
        - { canonical: "/0chain/log", location:  "/0chain_root/log" }
        - { canonical: "/0chain/data/redis/state" }
        - { canonical: "/0chain/data/redis/transactions" }
        - { canonical: "/0chain/data/rocksdb/state" }


      'sharder':
        - { canonical: "/0chain/0chain" }
        - { canonical: "/0chain/config" }
        - { canonical: "/0chain/nodes" }
        - { canonical: "/0chain/log", location:  "/0chain_root/log" }
        - { canonical: "/0chain/data", location:  "/0chain_efs/data" }
        - { canonical: "/0chain_efs/data/blocks"}
        - { canonical: "/0chain_efs/data/cassandra"}
        - { canonical: "/0chain_efs/data/rocksdb/blocksummary" }
        - { canonical: "/0chain_efs/data/rocksdb/roundsummary" }
        - { canonical: "/0chain_efs/data/rocksdb/state" }

nodefiles:
  file: "nodes.txt"
  dir:
    local: "{{artifact.local.base}}/nodes"
    zchain: "{{artifact.zchain.base}}/nodes"

blueprint.instance_tags: network_type={{blueprint.network_type}} network_name={{blueprint.network_name}}


zchain_config:
  file: "0chain.yaml"
  dir:
    local: "anchor/{{network}}"
    zchain: "{{artifact.zchain.config}}"

zchain:
  blueprint: "{{blueprint}}"
  credentials: "{{credential}}"
  artifact: "{{artifact}}"
  git: "{{git}}"

agents: "{{zchain.blueprint.sharders| dict2items | union(zchain.blueprint.miners | dict2items)}}"
agents_dict: "{{zchain.blueprint.sharders | combine(zchain.blueprint.miners)}}"

...