---
- name: "Set the EBS device to format"
  set_fact:
    ebs_device_name: "{{storage[zchain.blueprint.storage_ebs[agent_role]].ubuntu_disk}}"

- debug:
    msg: "{{agent_role}}:{{agent_tag}} storage=>{{ebs_device_name}}"

- name: "Install file-system for {{agent_tag}} on {{ebs_device_name}}"
  filesystem:
    fstype: ext4
    dev: "{{ebs_device_name}}"
    force: no

- name: "Set the base directory to mount"
  set_fact:
    mount_point: "{{zchain_volumes.ebs}}"

- name: Create the mount point
  file:
    path: mount_point
    state: directory
    owner: ubuntu
    group: ubuntu
    mode: 0755

- name: Mount the EBS block device
  mount:
    path: "{{mount_point}}"
    src: "{{ebs_device_name}}"
    state: mounted
    fstype: ext4
    boot: yes


- name: Get the EFS facts
  efs_facts:

- name: Mount the EFS file system
  mount:
    src: "fs-f3d221ea.efs.us-west-1.amazonaws.com:/"
    path: "{{zchain_volumes.efs}}"
    fstype: nfs4
    opts: nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport
    state: mounted
  when: agent_role == "sharder"

- name: Register the EFS to ubuntu
  file:
    path: "{{zchain_volumes.efs}}"
    owner: ubuntu
    group: ubuntu
    mode: "u=rwx,g=rx,o=rx"
  when: agent_role == "sharder"
...