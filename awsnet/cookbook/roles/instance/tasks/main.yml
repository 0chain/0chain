---
- import_tasks: instance-facts.yml
  tags:
    - instance-assemble-local
    - instance-assemble-remote
    - instance-teardown-local
    - instance-start-local
    - instance-stop-local

- include_tasks: instance-assemble-local.yml
  tags: ['instance-assemble-local']
  loop: "{{agents_dict | dict2items}}"
  loop_control:
    loop_var: agent

- include_tasks: instance-teardown-local.yml
  tags: ['instance-teardown-local']
  loop: "{{agents_dict | dict2items}}"
  loop_control:
    loop_var: agent

- include_tasks: instance-start-local.yml
  tags: ['instance-start-local']
  loop: "{{agents_dict | dict2items}}"
  loop_control:
    loop_var: agent

- include_tasks: instance-stop-local.yml
  tags: ['instance-stop-local']
  loop: "{{agents_dict | dict2items}}"
  loop_control:
    loop_var: agent

- import_tasks: instance-assemble-remote.yml
  tags: ['instance-assemble-remote']

- import_tasks: instance-reboot-remote.yml
  tags: ['instance-reboot-remote']
...

