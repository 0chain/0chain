---
- name: "Nodefile storage"
  debug:
    msg: "Node files storage: {{nodefiles}}"

#- name: "Copy the nodes yaml file to the agent"
#  become: yes
#  synchronize:
#    src: "{{nodefiles.dir.local}}/agent_nodes/{{nodefiles.file}}"
#    dest: "{{nodefiles.dir.zchain}}/{{nodesfiles.file}}"
#    use_ssh_args: yes
#    recursive: yes

- name: "Copy nodes.yaml file to the agent"
  become: yes
  copy:
    src: "{{nodefiles.dir.local}}/agent_nodes/{{nodefiles.file}}"
    dest: "{{nodefiles.dir.zchain}}/{{nodefiles.file}}"
    owner: 0chain
    group: 0chain
    mode: "u=rwX,g=rX,o=rX"

- name: "Copy the agent key file"
  become: yes
  copy:
    src: "{{nodefiles.dir.local}}/agent_keys/{{agent_name}}.txt"
    dest: "{{nodefiles.dir.zchain}}/{{agent_name}}.txt"
    owner: 0chain
    group: 0chain
    mode: "u=rwX,g=rX,o=rX"

- name: "Alter ownership to 0chain"
  become: yes
  file:
    path: "{{nodefiles.dir.zchain}}"
    owner: 0chain
    group: 0chain
    mode: "u=rwX,g=rX,o=rX"
    recurse: yes

#- name: Link the sharder and miner file...
#  become: yes
#  file:
#    src: "{{agent_name}}.txt"
#    dest: "{{nodefiles.dir.zchain}}/{{agent_role}}_key.txt"
#    state: link
#    owner: 0chain
#    group: 0chain
#
#- name: Copy the nodes file to the configuration directory
#  become: yes
#  copy:
#    src: "/0chain/nodes/nodes.yaml"
#    dest: "/0chain/config/nodes.yaml"
#    remote_src: yes
#    owner: 0chain
#    group: 0chain
...