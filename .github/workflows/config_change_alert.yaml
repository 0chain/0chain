name: config_change_alert

on:
  push:
    branches: 
      - staging
    paths:
      - docker.local/config/0chain.yaml
      - docker.local/config/sc.yaml

  pull_request:
    branches: 
      - staging
    paths:
      - .github/workflows/config_change_alert.yaml
      - docker.local/config/0chain.yaml
      - docker.local/config/sc.yaml
   
jobs:
  test:
    runs-on: docker-builds
    steps:
      - name: Install git
        run: |
          git --version
          sudo add-apt-repository ppa:git-core/ppa
          sudo apt update
          sudo apt install git -y
          git --version

      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0  # OR "2" -> To retrieve the preceding commit.
             
      - name: Notify changes in slack channel
        run: |
          echo '{"text":"'> diff.log
          git diff .github/workflows/config_change_alert.yaml >> diff.log
          git diff docker.local/config/0chain.yaml >> diff.log
          git diff docker.local/config/sc.yaml >> diff.log
          echo '"}'>> diff.log
          curl -X POST -H 'Content-type: application/json' -d @diff.log ${{ secrets.CHAT_WEBHOOK_URL }}